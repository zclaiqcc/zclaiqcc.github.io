<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="articles for tech &amp; life &amp; thoughts"><title>GIT - the stupid content tracker | Marktub</title><link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Raleway:400,300,600"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.1/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.1/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/2.0.4/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/2.1.4/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/2.1.4/toastr.min.css"><meta name="generator" content="Hexo 4.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">GIT - the stupid content tracker</h1><a id="logo" href="/.">Marktub</a><p class="description">Do not go gentle into that good night.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-4-4"><div class="content_container"><div class="post"><h1 class="post-title">GIT - the stupid content tracker</h1><div class="post-meta">2005-04-08<span> | </span><span class="category"><a href="/categories/resources/">resources</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Contents</div></div></div><div class="post-content"><p>origin: <a href="https://github.com/git/git/blob/e83c5163316f89bfbde7d9ab23ca2e25604af290/README">Initial revision of “git”, the information manager from hell</a></p>
<p>“git” can mean anything, depending on your mood.</p>
<ul>
<li>random three-letter combination that is pronounceable, and not<br>actually used by any common UNIX command.  The fact that it is a<br>mispronounciation of “get” may or may not be relevant.</li>
<li>stupid. contemptible and despicable. simple. Take your pick from the<br>dictionary of slang.</li>
<li>“global information tracker”: you’re in a good mood, and it actually<br>works for you. Angels sing, and a light suddenly fills the room. </li>
<li>“goddamn idiotic truckload of sh*t”: when it breaks</li>
</ul>
<p>This is a stupid (but extremely fast) directory content manager.  It<br>doesn’t do a whole lot, but what it <em>does</em> do is track directory<br>contents efficiently. </p>
<p>There are two object abstractions: the “object database”, and the<br>“current directory cache”.</p>
<pre><code>The Object Database (SHA1_FILE_DIRECTORY)</code></pre><p>The object database is literally just a content-addressable collection<br>of objects.  All objects are named by their content, which is<br>approximated by the SHA1 hash of the object itself.  Objects may refer<br>to other objects (by referencing their SHA1 hash), and so you can build<br>up a hierarchy of objects. </p>
<p>There are several kinds of objects in the content-addressable collection<br>database.  They are all in deflated with zlib, and start off with a tag<br>of their type, and size information about the data.  The SHA1 hash is<br>always the hash of the <em>compressed</em> object, not the original one.</p>
<p>In particular, the consistency of an object can always be tested<br>independently of the contents or the type of the object: all objects can<br>be validated by verifying that (a) their hashes match the content of the<br>file and (b) the object successfully inflates to a stream of bytes that<br>forms a sequence of <ascii tag without space> + <space> + <ascii decimal
size> + &lt;byte\0&gt; + <binary object data>. </p>
<p>BLOB: A “blob” object is nothing but a binary blob of data, and doesn’t<br>refer to anything else.  There is no signature or any other verification<br>of the data, so while the object is consistent (it <em>is</em> indexed by its<br>sha1 hash, so the data itself is certainly correct), it has absolutely<br>no other attributes.  No name associations, no permissions.  It is<br>purely a blob of data (ie normally “file contents”). </p>
<p>TREE: The next hierarchical object type is the “tree” object.  A tree<br>object is a list of permission/name/blob data, sorted by name.  In other<br>words the tree object is uniquely determined by the set contents, and so<br>two separate but identical trees will always share the exact same<br>object. </p>
<p>Again, a “tree” object is just a pure data abstraction: it has no<br>history, no signatures, no verification of validity, except that the<br>contents are again protected by the hash itself.  So you can trust the<br>contents of a tree, the same way you can trust the contents of a blob,<br>but you don’t know where those contents <em>came</em> from. </p>
<p>Side note on trees: since a “tree” object is a sorted list of<br>“filename+content”, you can create a diff between two trees without<br>actually having to unpack two trees.  Just ignore all common parts, and<br>your diff will look right.  In other words, you can effectively (and<br>efficiently) tell the difference between any two random trees by O(n)<br>where “n” is the size of the difference, rather than the size of the<br>tree. </p>
<p>Side note 2 on trees: since the name of a “blob” depends entirely and<br>exclusively on its contents (ie there are no names or permissions<br>involved), you can see trivial renames or permission changes by noticing<br>that the blob stayed the same.  However, renames with data changes need<br>a smarter “diff” implementation. </p>
<p>CHANGESET: The “changeset” object is an object that introduces the<br>notion of history into the picture.  In contrast to the other objects,<br>it doesn’t just describe the physical state of a tree, it describes how<br>we got there, and why. </p>
<p>A “changeset” is defined by the tree-object that it results in, the<br>parent changesets (zero, one or more) that led up to that point, and a<br>comment on what happened. Again, a changeset is not trusted per se:<br>the contents are well-defined and “safe” due to the cryptographically<br>strong signatures at all levels, but there is no reason to believe that<br>the tree is “good” or that the merge information makes sense. The<br>parents do not have to actually have any relationship with the result,<br>for example.</p>
<p>Note on changesets: unlike real SCM’s, changesets do not contain rename<br>information or file mode chane information.  All of that is implicit in<br>the trees involved (the result tree, and the result trees of the<br>parents), and describing that makes no sense in this idiotic file<br>manager.</p>
<p>TRUST: The notion of “trust” is really outside the scope of “git”, but<br>it’s worth noting a few things. First off, since everything is hashed<br>with SHA1, you <em>can</em> trust that an object is intact and has not been<br>messed with by external sources. So the name of an object uniquely<br>identifies a known state - just not a state that you may want to trust.</p>
<p>Furthermore, since the SHA1 signature of a changeset refers to the<br>SHA1 signatures of the tree it is associated with and the signatures<br>of the parent, a single named changeset specifies uniquely a whole<br>set of history, with full contents. You can’t later fake any step of<br>the way once you have the name of a changeset.</p>
<p>So to introduce some real trust in the system, the only thing you need<br>to do is to digitally sign just <em>one</em> special note, which includes the<br>name of a top-level changeset.  Your digital signature shows others that<br>you trust that changeset, and the immutability of the history of<br>changesets tells others that they can trust the whole history.</p>
<p>In other words, you can easily validate a whole archive by just sending<br>out a single email that tells the people the name (SHA1 hash) of the top<br>changeset, and digitally sign that email using something like GPG/PGP.</p>
<p>In particular, you can also have a separate archive of “trust points” or<br>tags, which document your (and other peoples) trust.  You may, of<br>course, archive these “certificates of trust” using “git” itself, but<br>it’s not something “git” does for you. </p>
<p>Another way of saying the same thing: “git” itself only handles content<br>integrity, the trust has to come from outside. </p>
<pre><code>Current Directory Cache (&quot;.dircache/index&quot;)</code></pre><p>The “current directory cache” is a simple binary file, which contains an<br>efficient representation of a virtual directory content at some random<br>time.  It does so by a simple array that associates a set of names,<br>dates, permissions and content (aka “blob”) objects together.  The cache<br>is always kept ordered by name, and names are unique at any point in<br>time, but the cache has no long-term meaning, and can be partially<br>updated at any time. </p>
<p>In particular, the “current directory cache” certainly does not need to<br>be consistent with the current directory contents, but it has two very<br>important attributes:</p>
<p> (a) it can re-generate the full state it caches (not just the directory<br>     structure: through the “blob” object it can regenerate the data too)</p>
<pre><code>As a special case, there is a clear and unambiguous one-way mapping
from a current directory cache to a &quot;tree object&quot;, which can be
efficiently created from just the current directory cache without
actually looking at any other data.  So a directory cache at any
one time uniquely specifies one and only one &quot;tree&quot; object (but
has additional data to make it easy to match up that tree object
with what has happened in the directory)</code></pre><p>and</p>
<p> (b) it has efficient methods for finding inconsistencies between that<br>     cached state (“tree object waiting to be instantiated”) and the<br>     current state. </p>
<p>Those are the two ONLY things that the directory cache does.  It’s a<br>cache, and the normal operation is to re-generate it completely from a<br>known tree object, or update/compare it with a live tree that is being<br>developed.  If you blow the directory cache away entirely, you haven’t<br>lost any information as long as you have the name of the tree that it<br>described. </p>
<p>(But directory caches can also have real information in them: in<br>particular, they can have the representation of an intermediate tree<br>that has not yet been instantiated.  So they do have meaning and usage<br>outside of caching - in one sense you can think of the current directory<br>cache as being the “work in progress” towards a tree commit).</p>
</div><div class="tags"><a href="/tags/git-Linus/"><i class="fa fa-tag"></i>git, Linus</a></div><div class="post-nav"><a class="pre" href="/2018/08/28/note-collection/">Note Collection</a></div></div></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>